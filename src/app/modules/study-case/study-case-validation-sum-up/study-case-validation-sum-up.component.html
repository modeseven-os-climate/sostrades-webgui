<div class="legend-header">
  <button
    mat-raised-button
    color="accent"
    [disabled]="isLoading"
    class="button-refresh"
    aria-label="Refresh tree node"
    (click)="refreshValidation(true)"
  >
    Refresh
    <mat-icon
      style="float: right; font-size: 16px; height: 26px; line-height: unset"
      >refresh</mat-icon
    >
  </button>
  <span class="spacer"></span>
  <span class="treenode-title">Data & Graph validation</span>
  <span class="spacer"></span>
  Color legend
  <button mat-button style="margin-left: 10px" color="undetermined">
    Not validated
  </button>
  <button mat-button style="margin-left: 10px" color="success">
    Validated
  </button>
  <button mat-button style="margin-left: 10px" color="warning">
    Partially validated
  </button>
</div>


<div
  *ngIf="isLoading"
  style="
    height: calc(100% - 40px);
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  "
>
  <mat-progress-spinner
    diameter="40"
    mode="indeterminate"
    style="margin: 0 auto"
  ></mat-progress-spinner>
  <div style="margin-top: 10px">Loading Data & Graph validation</div>
</div>

<div class="flex-container" *ngIf="originTreeNode && !isLoading">
  <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
    <!-- This is the tree node template for child nodes -->
    <mat-nested-tree-node
      *matTreeNodeDef="let node"
      [style.display]="node.isVisible ? 'block' : 'none'"
    >
      <li style="padding-left: 24px !important">
        <div class="mat-tree-node">
          <button
            mat-button
            [matTooltip]="node.modelsFullPathList | ontologyDisciplineConverter"
            matTooltipClass="custom-tooltip-class"
            style="margin-left: 5px !important"
          >
            <i [ngClass]="studyCaseDataService.iconMapping.get(node.nodeType)"> </i>
            {{ node.name }}
          </button>

          <button
            mat-button
            [color]="
              getColorForTreeNode(node.fullNamespace, validationType.DATA)
            "
            style="margin-left: 4px !important"
            *ngIf="
              this.studyTreeNodeValidationDict[node.fullNamespace] !==
                undefined &&
              this.studyTreeNodeValidationDict[node.fullNamespace].hasData
            "
          >
            <i class="fas fa-database fa-fw"> </i>
            Data
          </button>

          <button
            mat-button
            style="margin-left: 4px !important"
            *ngIf="
              this.studyTreeNodeValidationDict[node.fullNamespace] !==
                undefined &&
              this.studyTreeNodeValidationDict[node.fullNamespace].hasGraph
            "
            [color]="
              getColorForTreeNode(node.fullNamespace, validationType.GRAPH)
            "
          >
            <i class="fas fa-chart-line fa-fw"> </i>
            Graph
          </button>
        </div>
      </li>
    </mat-nested-tree-node>
    <!-- This is the tree node template for parent nodes -->
    <mat-nested-tree-node
      *matTreeNodeDef="let node; when: hasChild"
      [style.display]="node.isVisible ? 'block' : 'none'"
    >
      <li class="tree-container">
        <div class="mat-tree-node">
          <button
            mat-icon-button
            matTreeNodeToggle
            [attr.aria-label]="'toggle ' + node.name"
          >
            <i
              [ngClass]="
                treeControl.isExpanded(node)
                  ? 'fas fa-chevron-up fa-fw'
                  : 'fas fa-chevron-down fa-fw'
              "
              style="margin-left: 1px"
            >
            </i>
          </button>

          <button
            [id]="node.fullNamespace"
            mat-button
            [matTooltip]="node.modelsFullPathList | ontologyDisciplineConverter"
            matTooltipClass="custom-tooltip-class"
            style="margin-left: 4px !important"
          >
            <i
              [ngClass]="
                'fas fa-' +
                studyCaseDataService.iconMapping.get(node.nodeType) +
                ' fa-fw'
              "
            >
            </i>
            {{ node.name }}
          </button>

          <button
            mat-button
            style="margin-left: 4px !important"
            *ngIf="
              this.studyTreeNodeValidationDict[node.fullNamespace] !==
                undefined &&
              this.studyTreeNodeValidationDict[node.fullNamespace].hasData
            "
            [color]="
              getColorForTreeNode(node.fullNamespace, validationType.DATA)
            "
          >
            <i class="fas fa-database fa-fw"> </i>
            Data
          </button>
          <button
            mat-button
            style="margin-left: 4px !important"
            *ngIf="
              this.studyTreeNodeValidationDict[node.fullNamespace] !==
                undefined &&
              this.studyTreeNodeValidationDict[node.fullNamespace].hasGraph
            "
            [color]="
              getColorForTreeNode(node.fullNamespace, validationType.GRAPH)
            "
          >
            <i class="fas fa-chart-line fa-fw"> </i>
            Graph
          </button>
        </div>
        <ul [ngClass]="node.isLastChild ? 'last-child-left-border' : null">
          <div *ngIf="treeControl.isExpanded(node)">
            <ng-container matTreeNodeOutlet></ng-container>
          </div>
        </ul>
      </li>
    </mat-nested-tree-node>
  </mat-tree>
</div>
